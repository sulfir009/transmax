(()=>{"use strict";var e={requestCallback:"/ajax/callback"};jQuery(document).ready((function(){$('input[name="name"], #callback_phone, #callback_departure, #callback_arrival').on("input change",(function(){$(this).removeClass("error-border")})),document.getElementById("stationSelect").addEventListener("change",(function(){var e=this.value,t=$("#stationSelect").data("tour");fetch("/ajax/regular-races?stop_id=".concat(e,"&tour=").concat(t)).then((function(e){return e.text()})).then((function(e){document.querySelector("[data-content-way]").innerHTML=e})).catch((function(e){console.error("Ошибка при загрузке расписания:",e)}))})),$(".requestCallback").on("click",(function(t){t.preventDefault();var a=$(this).closest("form");a.find(".error-border").removeClass("error-border");var n={name:a.find('input[name="name"]').val(),phone:$.trim($("#callback_phone").val()),date:a.find('input[name="date"]').val(),arrival:$.trim($("#callback_arrival").val()),departure:$.trim($("#callback_departure").val()),comment:a.find('textarea[name="comment"]').val()},r=!1;if(n.name&&""!==n.name.trim()||(a.find('input[name="name"]').addClass("error-border"),r=!0),n.phone&&""!==n.phone.trim()||($("#callback_phone").addClass("error-border"),r=!0),n.departure&&""!==n.departure||($("#callback_departure").addClass("error-border"),r=!0),n.arrival&&""!==n.arrival||($("#callback_arrival").addClass("error-border"),r=!0),r)return!1;!function(t){$.ajax({type:"POST",url:e.requestCallback,contentType:"application/json",dataType:"json",data:JSON.stringify(t),headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(e){document.getElementById("successModal").style.display="flex"},error:function(e){alert("Request din`t send")}})}(n)}));var t=document.querySelectorAll(".buy-online-btn"),a=document.getElementById("calendar-modal"),n=document.getElementById("calendar"),r=document.getElementById("save-btn"),l=document.getElementById("cancel-btn"),c=document.getElementById("table_date"),d=null,o=[],i=!1,u="",s="",m="";function p(){b.set("disable",[function(e){return e<(new Date).setHours(0,0,0,0)}]),b.redraw()}function f(e){e.querySelectorAll(".highlight-day").forEach((function(e){return e.classList.remove("highlight-day")})),b.redraw()}function y(e,t){var a=document.createElement("input");return a.type="hidden",a.name=e,a.value=t,a}var b=flatpickr(n,{inline:!0,dateFormat:"Y-m-d",position:"auto center",disableMobile:!0,showMonths:1,monthSelectorType:"static",locale:document.documentElement.getAttribute("lang"),prevArrow:"←",nextArrow:"→",onChange:function(e,t){d=t},onDayCreate:function(e,t,a,n){var r=new Date(n.dateObj).getDay();o.includes(r)&&n.classList.add("highlight-day"),0!==r&&6!==r||(n.style.color="red",n.style.borderRadius=100,n.borderColor="blue")}});c.addEventListener("focus",(function(){i=!1,u="",s="",m="";o=[],p(),a.style.display="flex"})),t.forEach((function(e){e.addEventListener("click",(function(){var t=e.getAttribute("data-days").split(",").map(Number);o=t,p(),a.style.display="flex",i=!0,u=e.getAttribute("data-arrival"),s=e.getAttribute("data-departure"),m=e.getAttribute("data-redirect")}))})),r.addEventListener("click",(function(){if(i)if(d){f(document.querySelector(".flatpickr-calendar"));var e=document.createElement("form");e.method="POST",e.action=m,e.appendChild(y("departure",s)),e.appendChild(y("arrival",u)),e.appendChild(y("date",d)),e.appendChild(y("adults",1)),e.appendChild(y("kids",0)),document.body.appendChild(e),e.submit()}else alert("Пожалуйста, выберите дату.");else d?(c.value=d,a.style.display="none",f(document.querySelector(".flatpickr-calendar"))):alert("Пожалуйста, выберите дату.")})),l.addEventListener("click",(function(){f(document.querySelector(".flatpickr-calendar")),a.style.display="none"}))}))})();